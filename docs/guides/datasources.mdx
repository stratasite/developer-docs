# Datasources

Configure database connections for your Strata project.

## Learning Objectives

After completing this guide, you will be able to:
- Add datasources to your project
- Configure adapter-specific settings
- Set up authentication
- Test datasource connections
- Understand tier configuration

## What are Datasources?

Datasources connect Strata to your databases. They define:
- Database adapter (PostgreSQL, Snowflake, MySQL, etc.)
- Connection details (host, port, database, schema)
- Authentication credentials
- Performance tier (hot, warm, cold)

## Adding a Datasource

### Interactive Method

```bash
strata datasource add [ADAPTER]
```

**Examples:**
```bash
strata datasource add postgres
strata datasource add snowflake
strata datasource add mysql
```

The CLI will prompt you for:
1. **Datasource key**: Unique identifier (e.g., `warehouse`, `analytics_db`)
2. **Display name**: Human-readable name
3. **Adapter-specific settings**: Host, port, database, schema, etc.
4. **Credentials**: Username, password, API keys
5. **Tier**: Performance tier (hot/warm/cold)
6. **AI configuration**: Optional AI provider settings

### Manual Configuration

Edit `datasources.yml` directly:

```yaml
warehouse:
  adapter: postgres
  name: Production Warehouse
  description: Main data warehouse
  tier: hot
  query_timeout: 3600
  host: warehouse.example.com
  port: 5432
  database: analytics
  schema: public
  ssl: true
  username: strata_user
  # password: (set via strata datasource auth)
```

## Setting Credentials

Credentials are stored securely in `.strata` (not committed to git):

```bash
strata datasource auth warehouse
```

This prompts for credentials and stores them in `.strata`.

**Remote credentials** (stored on server):
```bash
strata datasource auth warehouse --remote
```

## Testing Connections

Test a datasource connection:

```bash
strata datasource test warehouse
```

This verifies:
- Connection parameters
- Authentication
- Database accessibility

## Listing Datasources

List all configured datasources:

```bash
strata datasource list
```

## Supported Adapters

Strata supports 8 database adapters:

1. **PostgreSQL** - Full PostgreSQL support
2. **Snowflake** - Snowflake data warehouse
3. **MySQL** - MySQL database
4. **SQL Server** - Microsoft SQL Server (including Azure)
5. **Athena** - AWS Athena
6. **Trino** - Trino/Presto
7. **DuckDB** - Embedded analytics database
8. **Druid** - Apache Druid

See [adapters reference](/docs/reference/adapters) for adapter-specific configuration.

## Tier Configuration

Tiers influence query routing and performance:

### hot
Fast, frequently accessed data. Highest priority.

```yaml
warehouse:
  adapter: postgres
  tier: hot
  # ... connection details
```

### warm
Moderate performance data. Used when hot tier unavailable.

```yaml
archive:
  adapter: postgres
  tier: warm
  # ... connection details
```

### cold
Archive/slow data (e.g., S3/Athena). Used as last resort.

```yaml
historical:
  adapter: athena
  tier: cold
  # ... connection details
```

## Query Timeout

Set maximum query execution time:

```yaml
warehouse:
  adapter: postgres
  query_timeout: 3600  # seconds (1 hour)
  # ... connection details
```

## Complete Examples

### PostgreSQL
```yaml
warehouse:
  adapter: postgres
  name: Production Warehouse
  tier: hot
  query_timeout: 3600
  host: db.example.com
  port: 5432
  database: analytics
  schema: public
  ssl: true
  username: strata_user
```

### Snowflake
```yaml
snowflake_dw:
  adapter: snowflake
  name: Snowflake Data Warehouse
  tier: hot
  account_identifier: xy12345
  database: ANALYTICS
  warehouse: COMPUTE_WH
  schema: PUBLIC
  role: ANALYST
  # Authentication: set via datasource auth
```

### Athena
```yaml
s3_data:
  adapter: athena
  name: S3 Data Lake
  tier: cold
  region: us-east-1
  s3_output_location: s3://my-bucket/athena-results/
  database: analytics
  catalog: awsdatacatalog
```

## Best Practices

1. **Use descriptive keys** - `warehouse` not `db1`
2. **Set appropriate tiers** - Match performance characteristics
3. **Store credentials securely** - Use `.strata` file, never commit
4. **Test connections** - Verify before deploying
5. **Set timeouts** - Prevent long-running queries
6. **Use SSL** - Encrypt connections in production

## Security

- Credentials stored in `.strata` (gitignored)
- File permissions set to 0600 (owner read/write only)
- API keys never accepted via command line
- Remote credentials stored on server (encrypted)

## Next Steps

- Read adapter-specific guides:
  - [PostgreSQL](/docs/reference/adapters/postgres)
  - [Snowflake](/docs/reference/adapters/snowflake)
  - [MySQL](/docs/reference/adapters/mysql)
- Learn about [multi-datasource queries](/docs/advanced/multi-datasource)
- Understand [cost optimization](/docs/advanced/cost-optimization)
