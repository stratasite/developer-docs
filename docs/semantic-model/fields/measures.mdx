# Measures

Measure fields represent aggregatable metrics.

## Overview

Measures are the quantitative fields in your semantic model. They represent metrics that can be aggregated (summed, averaged, counted, etc.).

## Characteristics

- **Aggregatable** - Must include aggregation functions (SUM, AVG, COUNT, etc.)
- **Cannot be grouped** - Measures are not used in GROUP BY
- **Examples**: Total Revenue, Order Count, Average Order Value, Profit Margin

## Basic Definition

```yaml
- type: measure
  name: Total Revenue
  description: Sum of all order amounts
  data_type: decimal
  expression:
    sql: sum(amount)
```

## Measure Properties

### name

Display name shown to users.

```yaml
name: Total Revenue
```

### description

Optional description explaining what the measure represents.

```yaml
description: Total revenue from all orders
```

### data_type

The data type of the measure. Typically `decimal` or `integer`.

```yaml
data_type: decimal
```

### expression

SQL expression with aggregation function.

```yaml
expression:
  sql: sum(amount)
```

**Required:** Must include aggregation (sum, avg, count, min, max, etc.)

## Optional Properties

### hidden

Hide measure from UI while keeping it available for calculations.

```yaml
hidden: true
```

### formatter

Apply formatting to numeric values.

```yaml
formatter: currency_usd  # currency_usd, percent, thousands, millions, billions, custom
```

[Learn about formatters →](/docs/semantic-model/fields/formatters)

### snapshot

For snapshot measures, specify `ending` or `beginning`.

```yaml
snapshot: ending
```

**Requires:** Table must have `snapshot_date` configured.

[Learn about snapshots →](/docs/advanced/snapshot-measures)

### exclusion_type

Exclude certain dimensions from grouping/filtering.

```yaml
exclusion_type: exclude  # exclude, exclude_all_except, exclude_all
exclusions:
  - type: dimension
    filter: ignore
    entities:
      - Region
```

[Learn about exclusions →](/docs/advanced/exclusions)

### inclusions

Force calculation at lower level before rolling up.

```yaml
inclusions:
  filter: apply
  aggregation: percentile_cont(0.5) WITHIN GROUP (ORDER BY @exp)
  dimensions:
    - Product Category
```

[Learn about inclusions →](/docs/advanced/inclusions)

## Aggregation Functions

### Sum

```yaml
- type: measure
  name: Total Revenue
  data_type: decimal
  expression:
    sql: sum(amount)
```

### Average

```yaml
- type: measure
  name: Average Order Value
  data_type: decimal
  expression:
    sql: avg(amount)
```

### Count

```yaml
- type: measure
  name: Order Count
  data_type: integer
  expression:
    sql: count(*)
```

### Count Distinct

```yaml
- type: measure
  name: Unique Customers
  data_type: integer
  expression:
    sql: count(distinct customer_id)
```

### Min/Max

```yaml
- type: measure
  name: First Order Date
  data_type: date
  expression:
    sql: min(order_date)

- type: measure
  name: Last Order Date
  data_type: date
  expression:
    sql: max(order_date)
```

## Common Patterns

### Simple Sum

```yaml
- type: measure
  name: Total Sales
  data_type: decimal
  formatter: currency_usd
  expression:
    sql: sum(sales_amount)
```

### Count with Filter

```yaml
- type: measure
  name: Completed Orders
  data_type: integer
  expression:
    sql: count(CASE WHEN status = 'completed' THEN 1 END)
```

### Percentage

```yaml
- type: measure
  name: Profit Margin
  data_type: decimal
  formatter: percent
  expression:
    sql: sum(profit) / sum(revenue)
```

### Complex Calculation

```yaml
- type: measure
  name: Revenue per Customer
  data_type: decimal
  formatter: currency_usd
  expression:
    sql: sum(amount) / count(distinct customer_id)
```

## Advanced Measures

### Snapshot Measures

Point-in-time measures:

```yaml
- type: measure
  name: Ending Inventory
  data_type: integer
  snapshot: ending
  expression:
    sql: sum(quantity)
```

[Learn about snapshots →](/docs/advanced/snapshot-measures)

### Exclusion Measures

Exclude certain dimensions:

```yaml
- type: measure
  name: Revenue (Excluding Returns)
  data_type: decimal
  exclusion_type: exclude
  exclusions:
    - type: dimension
      filter: apply
      entities:
        - Return Status
  expression:
    sql: sum(amount)
```

[Learn about exclusions →](/docs/advanced/exclusions)

### Inclusion Measures

Multi-level calculations:

```yaml
- type: measure
  name: Median Order Value
  data_type: decimal
  inclusions:
    filter: apply
    aggregation: percentile_cont(0.5) WITHIN GROUP (ORDER BY @exp)
    dimensions:
      - Product Category
  expression:
    sql: sum(amount)
```

[Learn about inclusions →](/docs/advanced/inclusions)

## Best Practices

1. **Always include aggregation** - Measures must have SUM, AVG, COUNT, etc.
2. **Use appropriate data types** - `decimal` for money, `integer` for counts
3. **Add formatters** - Currency, percentage formatting improves UX
4. **Add descriptions** - Help users understand measures
5. **Use descriptive names** - Business-friendly measure names
6. **Test calculations** - Verify measures calculate correctly

## Next Steps

- Learn about [dimensions](/docs/semantic-model/fields/dimensions)
- Explore [data types](/docs/semantic-model/fields/data-types)
- Understand [formatters](/docs/semantic-model/fields/formatters)
- Read about [expressions](/docs/semantic-model/expressions/sql)
- Explore [advanced measures](/docs/advanced)
